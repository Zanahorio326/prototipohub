<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Módulo Botón</title>
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    html, body, #btnTool {
      width: 100%;
      height: 100%;
    }
    #btnTool {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: white;
      border: 1px solid #ccc;
      cursor: pointer;
      font-family: sans-serif;
      user-select: none;
      font-size: 14px;
      gap: 2px;
      padding: 5px;
    }
    .emoji { font-size: 20px; }

    #btnConfig {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 15px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 10000;
      display: none;
    }
    #btnConfig input, #btnConfig select {
      margin: 5px 0;
      width: 200px;
    }
  </style>
</head>
<body>
  <div id="btnTool">
    <span class="emoji">🔘</span>
    <span>Botón</span>
  </div>

  <div id="btnConfig">
    <label>Texto: <input type="text" id="btnText"></label>
    <label>URL: <input type="text" id="btnUrl"></label>
    <label>Color: <input type="color" id="btnColor"></label>
    <label>Forma:
      <select id="btnShape">
        <option value="rect">Rectangular</option>
        <option value="round">Redondeado</option>
        <option value="circle">Circular</option>
      </select>
    </label>
    <button onclick="applyConfig()">Aplicar</button>
  </div>

  <script>
    let currentButtonId = null;

    // Escuchar apertura de configuración desde el padre
    window.addEventListener('message', e => {
      if (e.data?.action === 'openButtonConfig') {
        currentButtonId = e.data.buttonId;
        window.parent.postMessage({ 
          action: 'getButtonData',
          buttonId: currentButtonId
        }, '*');
      }
      
      if (e.data?.action === 'sendButtonData') {
        document.getElementById('btnText').value = e.data.text;
        document.getElementById('btnUrl').value = e.data.url || '';
        document.getElementById('btnColor').value = e.data.color || '#ffffff';
        document.getElementById('btnShape').value = e.data.shape || 'rect';
        document.getElementById('btnConfig').style.display = 'block';
      }
    });

    function applyConfig() {
      window.parent.postMessage({
        action: 'updateButton',
        buttonId: currentButtonId,
        text: document.getElementById('btnText').value,
        url: document.getElementById('btnUrl').value,
        color: document.getElementById('btnColor').value,
        shape: document.getElementById('btnShape').value
      }, '*');
      
      document.getElementById('btnConfig').style.display = 'none';
    }

    // Crear nuevos botones
    document.getElementById('btnTool').addEventListener('click', e => {
      window.parent.postMessage({ 
        action: 'createButton',
        x: e.clientX,
        y: e.clientY
      }, '*');
    });
  </script>
</body>
</html>