<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Módulo Botón</title>
  <style>
    /* Estilos del panel de edición de botón */
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #f9f9f9;
    }
    .panel-wrapper {
      width: 300px;
      padding: 20px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .panel-wrapper h1 {
      margin: 0 0 16px;
      font-size: 18px;
      text-align: center;
    }
    .button-tools {
      display: block; /* Mostrar siempre para verificar la UI */
    }
    .button-tools label {
      font-size: 14px;
      margin-top: 4px;
      display: block;
    }
    .button-tools input,
    .button-tools select {
      display: block;
      margin-bottom: 8px;
      width: 100%;
      padding: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    .button-tools button {
      margin-top: 12px;
      width: 100%;
      padding: 8px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .button-tools button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="panel-wrapper">
    <h1>Módulo Botón</h1>
    <!-- Panel de configuración del botón -->
    <div class="button-tools" id="buttonTools">
      <label>Texto del botón:<input type="text" id="btnTextInput" placeholder="Texto..."/></label>
      <label>Enlace URL:<input type="text" id="btnUrlInput" placeholder="https://..."/></label>
      <label>Color de fondo:<input type="color" id="btnBgInput" value="#cccccc"/></label>
      <label>Forma:
        <select id="btnShapeSelect">
          <option value="rectangular">Rectangular</option>
          <option value="redondeada">Redondeada</option>
          <option value="circular">Circular</option>
          <option value="rombo">Rombo</option>
        </select>
      </label>
      <button id="btnApply">Aplicar</button>
    </div>
  </div>

  <script>
    // Referencias a los controles
    const buttonTools   = document.getElementById('buttonTools');
    const btnTextInput  = document.getElementById('btnTextInput');
    const btnUrlInput   = document.getElementById('btnUrlInput');
    const btnBgInput    = document.getElementById('btnBgInput');
    const btnShapeSelect= document.getElementById('btnShapeSelect');
    const btnApply      = document.getElementById('btnApply');

    // Datos del botón que se está editando
    let currentData = { id: null, text: '', url: '', bg: '#ffffff', shape: 'rectangular' };

    // Notificar al padre que está listo
    parent.postMessage({ type: 'moduleButtonReady' }, '*');

    // Escucha mensajes desde la página padre
    window.addEventListener('message', e => {
      const data = e.data;
      if (!data || data.type !== 'openButtonTools') return;
      // Guardamos el estado actual
      currentData = { ...data };
      // Rellenamos los controles con los valores recibidos
      btnTextInput.value   = data.text;
      btnUrlInput.value    = data.url;
      btnBgInput.value     = data.bg;
      btnShapeSelect.value = data.shape;

      // Asegurarnos de que el panel está visible
      buttonTools.style.display = 'block';
    });

    // Al aplicar, enviamos los nuevos valores al padre y ocultamos
    btnApply.addEventListener('click', () => {
      const response = {
        type:  'applyButtonTools',
        id:    currentData.id,
        text:  btnTextInput.value,
        url:   btnUrlInput.value,
        bg:    btnBgInput.value,
        shape: btnShapeSelect.value
      };
      parent.postMessage(response, '*');
      // Ocultar tras aplicar
      buttonTools.style.display = 'none';
    });
  </script>
</body>
</html>