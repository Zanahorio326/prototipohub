<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Libro de diagramas</title>
  <style>
    html,body{height:100%; margin:0; padding:0; overflow:hidden;}
    body{
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: linear-gradient(180deg,#d1d5db,#9ca3af);
      display:flex; align-items:center; justify-content:center;
    }

    .stage{ width:100%; height:100%; display:flex; align-items:center; justify-content:center; overflow:hidden; padding:0 4%; }
    .single, .spread{ display:flex; align-items:center; justify-content:center; }

    .page{
      cursor:pointer;
      background:#fff;
      box-shadow: 0 8px 24px rgba(2,6,23,0.32);
      border-radius: 10px;
      box-sizing: border-box;
      overflow:hidden;
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      transition: width .22s ease, height .22s ease;
    }

    .spread{ gap: var(--gap, 18px); }
    .page img{ width:100%; height:100%; object-fit:cover; display:block; border-radius:0; }

    .hint{ position: absolute; bottom:18px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.35); color:#fff; padding:6px 12px; border-radius:999px; font-size:.85rem }

    .fullscreen-overlay{
      position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; display:flex; align-items:center; justify-content:center; flex-direction:column; z-index:1000;
      overflow:auto; -webkit-overflow-scrolling: touch;
    }
    .fullscreen-overlay img, .fullscreen-overlay .page-content{ width:90%; max-width:1200px; }
    .close-btn{
      position:absolute; top:16px; right:16px; font-size:1.8rem; background:rgba(0,0,0,0.35); color:#fff; border:none; border-radius:50%; padding:6px 12px; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="stage" id="stage"></div>
  <div class="hint">Desliza ← o →</div>

  <script>
    (function(){
      const AR = 3/4;
      const MARGIN = 0.04;
      const stage = document.getElementById('stage');
      let current = 'cover';
      let spreadIndex = 0;

      const COVER_GIF = 'https://zanahorio326.github.io/prototipohub/portada.gif';
      const IMAGES = [
        'https://zanahorio326.github.io/prototipohub/1.jpg',
        'https://zanahorio326.github.io/prototipohub/2.jpg',
        'https://zanahorio326.github.io/prototipohub/3.jpg',
        'https://zanahorio326.github.io/prototipohub/4.jpg',
        'https://zanahorio326.github.io/prototipohub/5.jpg',
        'https://zanahorio326.github.io/prototipohub/6.jpg',
        'https://zanahorio326.github.io/prototipohub/7.jpg',
        'https://zanahorio326.github.io/prototipohub/8.jpg',
        'https://zanahorio326.github.io/prototipohub/9.jpg',
        'https://zanahorio326.github.io/prototipohub/10.jpg',
        'https://zanahorio326.github.io/prototipohub/11.jpg',
        'https://zanahorio326.github.io/prototipohub/12.jpg',
        'https://zanahorio326.github.io/prototipohub/13.jpg',
        'https://zanahorio326.github.io/prototipohub/14.jpg',
        'https://zanahorio326.github.io/prototipohub/15.jpg',
        'https://zanahorio326.github.io/prototipohub/16.jpg'
      ];

      function computeSingleSize(){
        const vw = window.innerWidth * (1 - 2 * MARGIN);
        const vh = window.innerHeight * (1 - 2 * MARGIN);
        let width = vw;
        let height = Math.min(vh, width / AR);
        if(height > vh){ height = vh; width = height * AR; }
        return {w: Math.round(width), h: Math.round(height)};
      }

      function computeDoubleSize(singleSize){
        const vw = window.innerWidth * (1 - 2 * MARGIN);
        const vh = window.innerHeight * (1 - 2 * MARGIN);
        const gap = Math.max(12, Math.round(vw * 0.03));
        const availW = vw - gap;
        const perPageMaxW = availW / 2;
        let height = Math.min(vh, perPageMaxW / AR);
        let width = Math.round(height * AR);
        return {w: width, h: height, gap};
      }

      function openFullscreen(contentHtml){
        document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes');

        const overlay = document.createElement('div');
        overlay.className = 'fullscreen-overlay';
        const closeBtn = document.createElement('button');
        closeBtn.className = 'close-btn';
        closeBtn.innerText = '❎';
        closeBtn.onclick = () => {
          overlay.remove();
          document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
        };
        const pageDiv = document.createElement('div');
        pageDiv.className = 'page-content';
        pageDiv.innerHTML = contentHtml;
        overlay.appendChild(closeBtn);
        overlay.appendChild(pageDiv);
        document.body.appendChild(overlay);
      }

      function renderCover(){
        stage.innerHTML = '';
        stage.className = 'stage single';
        const s = computeSingleSize();
        const page = document.createElement('div');
        page.className = 'page';
        page.style.width = s.w + 'px';
        page.style.height = s.h + 'px';
        page.style.borderRadius = '10px';
        page.innerHTML = `<img src="${COVER_GIF}">`;
        page.onclick = () => openFullscreen(page.innerHTML);
        stage.appendChild(page);
      }

      function renderSpread(idx){
        stage.innerHTML = '';
        stage.className = 'stage spread';
        const single = computeSingleSize();
        const d = computeDoubleSize(single);
        const container = document.createElement('div');
        container.className = 'spread';
        container.style.setProperty('--gap', d.gap + 'px');

        const leftIndex = idx*2; // corregido para retraso, 0 es la página 2 real
        const rightIndex = 1 + idx*2;

        if(leftIndex >= IMAGES.length) return;

        const left = document.createElement('div');
        left.className = 'page';
        left.style.width = d.w + 'px';
        left.style.height = d.h + 'px';
        left.innerHTML = `<img src="${IMAGES[leftIndex]}">`;
        left.onclick = () => openFullscreen(left.innerHTML);

        const right = document.createElement('div');
        right.className = 'page';
        right.style.width = d.w + 'px';
        right.style.height = d.h + 'px';
        if(rightIndex < IMAGES.length){
          right.innerHTML = `<img src="${IMAGES[rightIndex]}">`;
          right.onclick = () => openFullscreen(right.innerHTML);
        }

        container.appendChild(left);
        if(rightIndex < IMAGES.length) container.appendChild(right);
        stage.appendChild(container);
      }

      function render(){
        if(current === 'cover') renderCover();
        else renderSpread(spreadIndex);
      }

      let sx = 0;
      stage.addEventListener('touchstart', e => { sx = e.touches[0].clientX; }, {passive:true});
      stage.addEventListener('touchend', e => {
        const ex = e.changedTouches[0].clientX;
        const dx = sx - ex;
        if (dx > 40) {
          if(current === 'cover'){
            current = 'spread'; spreadIndex = 0;
          } else {
            spreadIndex++;
            if(spreadIndex*2 >= IMAGES.length) spreadIndex--;
          }
          render();
        } else if (dx < -40) {
          if(current === 'spread' && spreadIndex > 0){
            spreadIndex--;
          } else {
            current = 'cover'; spreadIndex = 0;
          }
          render();
        }
      }, {passive:true});

      window.addEventListener('resize', render);
      window.addEventListener('orientationchange', render);
      render();
    })();
  </script>
</body>
</html>